<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>â¤ Love â¤</title>
<style>
html,body{
  margin:0; padding:0; width:100%; height:100%;
  background: radial-gradient(circle at top, #2b0018, #050008);
  overflow:hidden; font-family:"Segoe UI",sans-serif;
}
canvas{position:absolute; left:0; top:0;}
#tip{
  position:fixed; bottom:14px; width:100%; text-align:center;
  color:rgba(255,180,200,.9); font-size:13px; line-height:1.6;
}
#play{
  position:fixed; right:12px; top:12px;
  background:rgba(255,120,150,.25);
  border:1px solid rgba(255,200,210,.5);
  color:#fff; padding:6px 12px; border-radius:24px;
  box-shadow:0 0 12px rgba(255,120,160,.5);
}
#loveText{
  position:fixed; top:45%; width:100%; text-align:center;
  font-size:24px; letter-spacing:2px; color:#ffd1dc;
  text-shadow:0 0 14px rgba(255,120,160,1);
}
</style>
</head>
<body>
<canvas id="bg"></canvas>
<div id="loveText"></div>
<button id="play">ğŸµ æ’­æ”¾éŸ³ä¹</button>
<input id="file" type="file" accept="audio/*" style="display:none">
<div id="tip">ğŸ’— è½»è§¦çƒŸèŠ±ä¸ºä½ ç»½æ”¾<br>ğŸŒ¹ è¿™ä¸€æœµç«ç‘°ï¼Œåªä¸ºä½ æ‘‡æ›³</div>

<audio id="music" loop>
  <source src="music.mp3" type="audio/mpeg">
</audio>

<script>
const canvas = document.getElementById('bg');
const ctx = canvas.getContext('2d');
const dpr = window.devicePixelRatio || 1;
function resize(){
  canvas.width = innerWidth * dpr;
  canvas.height = innerHeight * dpr;
  canvas.style.width = innerWidth+'px';
  canvas.style.height = innerHeight+'px';
  ctx.setTransform(dpr,0,0,dpr,0,0);
}
resize(); window.addEventListener('resize',()=>location.reload());

class Particle{
  constructor(x,y,vx,vy,r,c){
    this.x=x; this.y=y; this.vx=vx; this.vy=vy;
    this.life=1; this.r=r; this.c=c;
  }
  step(){ this.x+=this.vx; this.y+=this.vy; this.vy+=0.02; this.life-=0.01; }
  draw(){
    ctx.globalAlpha=Math.max(this.life,0);
    ctx.fillStyle=this.c;
    ctx.beginPath(); ctx.arc(this.x,this.y,this.r,0,Math.PI*2); ctx.fill();
    ctx.globalAlpha=1;
  }
}
let particles=[];

function heart(t){
  return {
    x:16*Math.pow(Math.sin(t),3),
    y:-(13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t))
  };
}

function spawnHeart(){
  const cx=innerWidth/2, cy=innerHeight/2;
  for(let i=0;i<140;i++){
    const t=Math.random()*Math.PI*2, p=heart(t);
    particles.push(new Particle(
      cx+p.x*8, cy+p.y*8,
      (Math.random()-0.5)*0.9, (Math.random()-0.5)*0.9,
      2, `rgb(255,${100+Math.random()*80},${150+Math.random()*80})`
    ));
  }
}

function firework(x,y){
  for(let i=0;i<90;i++){
    const a=Math.random()*Math.PI*2, s=Math.random()*4+1;
    particles.push(new Particle(x,y,Math.cos(a)*s,Math.sin(a)*s,2.2,
      `hsl(${Math.random()*360},100%,70%)`));
  }
}

// ğŸŒ¹ æ–°ç«ç‘°ï¼šæ‰‹ç»˜èŠ±æŸé£ + è½»å¾®å‘¼å¸æ‘‡æ›³
function drawRose(x,y,scale,phase){
  ctx.save();
  const sway=Math.sin(Date.now()/900+phase)*6;
  ctx.translate(x,y+sway);
  ctx.scale(scale,scale);

  // èŒ
  ctx.strokeStyle='#2e8b57';
  ctx.lineWidth=4;
  ctx.beginPath(); ctx.moveTo(0,30); ctx.lineTo(0,120); ctx.stroke();

  // å¶å­
  ctx.fillStyle='#3fa76b';
  ctx.beginPath(); ctx.ellipse(-14,80,18,7,Math.PI/5,0,Math.PI*2); ctx.fill();
  ctx.beginPath(); ctx.ellipse(16,60,18,7,-Math.PI/5,0,Math.PI*2); ctx.fill();

  // èŠ±ç“£
  for(let i=0;i<12;i++){
    ctx.save();
    ctx.rotate(i*Math.PI/6);
    const g=ctx.createLinearGradient(0,0,22,0);
    g.addColorStop(0,'#ffe1ea');
    g.addColorStop(1,'#c4002f');
    ctx.fillStyle=g;
    ctx.beginPath(); ctx.ellipse(22,0,18,10,0,0,Math.PI*2); ctx.fill();
    ctx.restore();
  }
  ctx.fillStyle='#ff6f91';
  ctx.beginPath(); ctx.arc(0,0,10,0,Math.PI*2); ctx.fill();
  ctx.restore();
}

function animate(){
  ctx.clearRect(0,0,innerWidth,innerHeight);

  drawRose(innerWidth*0.28,innerHeight*0.68,1.1,0);
  drawRose(innerWidth*0.72,innerHeight*0.65,1.0,1);

  particles.forEach(p=>{p.step(); p.draw();});
  particles=particles.filter(p=>p.life>0);
  requestAnimationFrame(animate);
}

spawnHeart(); animate();

const lines=['é‡è§ä½ ä¹‹åï¼Œ','è¿é£éƒ½æ˜¯æ¸©æŸ”çš„ï¼Œ','è€Œæˆ‘åªæƒ³é è¿‘ä½ ã€‚','â¤'];
let idx=0; const textBox=document.getElementById('loveText');
setInterval(()=>{ if(idx<lines.length){ textBox.innerHTML+=lines[idx]+'<br>'; idx++; } },1800);

canvas.addEventListener('click',e=>firework(e.clientX,e.clientY));
canvas.addEventListener('touchstart',e=>firework(e.touches[0].clientX,e.touches[0].clientY));

const music=document.getElementById('music');
const playBtn=document.getElementById('play'); 
const fileInput=document.getElementById('file');
let playing=false;

// ç‚¹å‡»æŒ‰é’®ï¼šç¬¬ä¸€æ¬¡é€‰æ‹©éŸ³ä¹ï¼Œå…¶ä½™æ’­æ”¾/æš‚åœ
playBtn.onclick=()=>{
  if(!music.src || music.src===''){
    fileInput.click();
    return;
  }
  if(!playing){music.play(); playBtn.innerText='â¸ æš‚åœéŸ³ä¹';}
  else{music.pause(); playBtn.innerText='ğŸµ æ’­æ”¾éŸ³ä¹';}
  playing=!playing;
};

// é€‰æ‹©æœ¬åœ°éŸ³ä¹
fileInput.onchange=e=>{
  const file=e.target.files[0];
  if(!file) return;
  music.src=URL.createObjectURL(file);
  music.play();
  playing=true;
  playBtn.innerText='â¸ æš‚åœéŸ³ä¹';
};
</script>
</body>
</html>
